<Window x:Class="WpfAppCasa3D.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WpfAppCasa3D"
        mc:Ignorable="d"
        Title="Visualizador da Casa 3D" Height="600" Width="800">

    <!-- O Viewport3D renderiza toda a cena: Câmera, Modelos (geometria) e Luzes.-->
    <Viewport3D>
        <!-- Questão 3: -->
        <Viewport3D.Camera>
            <!-- 
            Position: Ponto X,Y,Z onde a câmera está.
            LookDirection: Vetor que indica para onde a câmera aponta (em direção à origem).
            UpDirection: Vetor que define o a parte de cima.
            FieldOfView: Ângulo de abertura da lente.
            Near/Far Plane Distance: distancia de renderização.
            -->
            <PerspectiveCamera Position="10, 5, 10" 
                               LookDirection="-10, -5, -10" 
                               UpDirection="0,1,0" 
                               FieldOfView="60"
                               NearPlaneDistance= "0.2" 
                               FarPlaneDistance="1000"
                               >
                <!-- .Transform na câmera para que o Storyboard possa gerar a animação com o identificador x:Name="CameraRotation" -->
                <PerspectiveCamera.Transform>
                    <!-- Adicionando CenterX/Y/Z para girar em torno do centro da casa ao invés do ponto de origem -->
                    <RotateTransform3D CenterX="2" CenterY="0" CenterZ="2">
                        <RotateTransform3D.Rotation>
                            <!-- AxisAngle Rotation para rotacionar a câmera pelo StoryBoard . O Eixo "0, 1, 0" é o eixo "vertical" (pitch) -->
                            <AxisAngleRotation3D x:Name="CameraRotation" Axis="0, 1, 0" Angle="360" />
                        </RotateTransform3D.Rotation>
                    </RotateTransform3D>
                </PerspectiveCamera.Transform>
            </PerspectiveCamera>
        </Viewport3D.Camera>

        <!-- Model Visual 3D: Monta as luzes e os modelos-->
        <ModelVisual3D>
            <ModelVisual3D.Content>
                <Model3DGroup>
                    <!-- Luz Ambiente-->
                    <AmbientLight Color="#808080" />

                    <!-- Questão 4: -->
                    <!-- Luz 1: -->
                    <DirectionalLight Color="#808080" Direction="1, 0.57, -1">
                        <!-- .Transform na câmera para que o Storyboard possa gerar a animação com o identificador x:Name="Light1Rotation" -->
                        <DirectionalLight.Transform>
                            <RotateTransform3D>
                                <RotateTransform3D.Rotation>
                                    <AxisAngleRotation3D x:Name="Light1Rotation" Axis="0, 1, 0" Angle="0" />
                                </RotateTransform3D.Rotation>
                            </RotateTransform3D>
                        </DirectionalLight.Transform>
                    </DirectionalLight>

                    <!-- Luz 2:  -->
                    <DirectionalLight Color="#808080" Direction="-1, 0.57, 1">
                        <!-- .Transform na câmera para que o Storyboard possa gerar a animação com o identificador x:Name="Light2Rotation" -->
                        <DirectionalLight.Transform>
                            <RotateTransform3D>
                                <RotateTransform3D.Rotation>
                                    <AxisAngleRotation3D x:Name="Light2Rotation" Axis="0, 1, 0" Angle="0" />
                                </RotateTransform3D.Rotation>
                            </RotateTransform3D>
                        </DirectionalLight.Transform>
                    </DirectionalLight>


                    <!-- Questão 2: 
                    GeometryModel3D: Monta os vértices, triângulos e material de cada elemento 
                    
                    .Geometry / MeshGeometry: Define os vértices com Positions e os triângulos com TriangleIndices
                    .Material / DiffuseMaterial: Define o Material do modelo, cor, imagem etc... -->
                    <GeometryModel3D>
                        <GeometryModel3D.Geometry>
                            <!-- Chão como um plano grande. Definimos 4 vértices e 2 triângulos -->
                            <!-- Modificado pela IA: Definindo os 4 vértices do plano (V0, V1, V2, V3) 
     O vértice "50,0,-50" (V1) estava faltando. -->
                            <!-- Modificado pela IA: Índices corretos para os 4 vértices (Triângulos 0,1,2 e 0,2,3) -->
                            <MeshGeometry3D
                                Positions="-9999,0,-9999
                                           9999,0,-9999
                                           9999,0,9999
                                           -9999,0,9999"
                                TriangleIndices="2 1 0
                                                 3 2 0"
                                
                                TextureCoordinates="0,0  5000,0  5000,5000  0,5000" />
                                <!-- 
                            TextureCoordinates: Mapeia os vértices (Positions) para coordenadas na imagem.
                            Ao usar valores > 1 (como 10,10), fazemos a textura se repetir 10x.
                            -->
                        </GeometryModel3D.Geometry>
                        <GeometryModel3D.Material>
                            <!-- 
                            Usamos DiffuseMaterial para uma aparência fosca.
                            O Brush é um ImageBrush que carrega a textura.
                            -->
                            <DiffuseMaterial>
                                <DiffuseMaterial.Brush>
                                    <!-- Modificado pela IA: Adicionado TileMode="Tile" para que a textura se repita, 
                                         conforme solicitado pelo TextureCoordinates (10,10) e pelo trabalho C2. -->
                                    <ImageBrush ImageSource="/textura_pedra.jpg" 
                                                TileMode="Tile"
                                                ViewportUnits="Absolute"/>
                                </DiffuseMaterial.Brush>
                            </DiffuseMaterial>
                        </GeometryModel3D.Material>
                    </GeometryModel3D>


                    <!-- Questão 1: 
                    Cada cômodo e o telhado são um GeometryModel3D separado para que possam ter cores (Materiais) diferentes. -->

                    <!-- Cômodo 1 (Cubo Vermelho) - Posição: (0, 0, 0) -->
                    <GeometryModel3D>
                        <GeometryModel3D.Geometry>
                            <MeshGeometry3D 
                                Positions="0,0,0 
                                           2,0,0 
                                           2,2,0 
                                           0,2,0 
                                           0,0,2 
                                           2,0,2
                                           2,2,2
                                           0,2,2"
                                TriangleIndices="0 1 2, 
                                               0 2 3,
                                               4 5 6,
                                               4 6 7,
                                               0 1 5,
                                               0 5 4,
                                               0 3 7,
                                               0 7 4,
                                               1 2 6,
                                               1 6 5" />
                        </GeometryModel3D.Geometry>
                        <GeometryModel3D.Material>
                            <DiffuseMaterial Brush="Red"/>
                        </GeometryModel3D.Material>
                        <!-- BackMaterial para renderizar as faces internas do cubo -->
                        <GeometryModel3D.BackMaterial>
                            <DiffuseMaterial Brush="Red"/>
                        </GeometryModel3D.BackMaterial>
                    </GeometryModel3D>

                    <!-- Cômodo 2 (Cubo Verde) - Posição: (2, 0, 0) -->
                    <GeometryModel3D>
                        <GeometryModel3D.Geometry>
                            <MeshGeometry3D 
                                Positions="2,0,0
                                           4,0,0
                                           4,2,0
                                           2,2,0
                                           2,0,2
                                           4,0,2
                                           4,2,2
                                           2,2,2"
                                TriangleIndices="0 1 2,
                                               0 2 3,
                                               4 5 6,
                                               4 6 7,
                                               0 1 5,
                                               0 5 4,
                                               0 3 7,
                                               0 7 4,
                                               1 2 6,
                                               1 6 5" />
                        </GeometryModel3D.Geometry>
                        <GeometryModel3D.Material>
                            <DiffuseMaterial Brush="Green"/>
                        </GeometryModel3D.Material>
                        <!-- BackMaterial para renderizar as faces internas -->
                        <GeometryModel3D.BackMaterial>
                            <DiffuseMaterial Brush="Green"/>
                        </GeometryModel3D.BackMaterial>
                    </GeometryModel3D>

                    <!-- Cômodo 3 (Cubo Azul) - Posição: (0, 0, 2) -->
                    <GeometryModel3D>
                        <GeometryModel3D.Geometry>
                            <MeshGeometry3D 
                                Positions="0,0,2
                                           2,0,2
                                           2,2,2
                                           0,2,2
                                           0,0,4
                                           2,0,4
                                           2,2,4
                                           0,2,4"
                                TriangleIndices="0 1 2,
                                               0 2 3,
                                               4 5 6,
                                               4 6 7,
                                               0 1 5,
                                               0 5 4,
                                               0 3 7,
                                               0 7 4,
                                               1 2 6,
                                               1 6 5" />
                        </GeometryModel3D.Geometry>
                        <GeometryModel3D.Material>
                            <DiffuseMaterial Brush="Blue"/>
                        </GeometryModel3D.Material>
                        <!-- BackMaterial para renderizar as faces -->
                        <GeometryModel3D.BackMaterial>
                            <DiffuseMaterial Brush="Blue"/>
                        </GeometryModel3D.BackMaterial>
                    </GeometryModel3D>

                    <!-- Geometria do telhado refeita para cobrir a casa.
                                 Vértices (Positions):
                                 V0: (0, 2, 0) - Canto Traseiro-Esquerdo
                                 V1: (4, 2, 0) - Canto Traseiro-Direito
                                 V2: (4, 2, 2) - Canto Frontal-Direito (Cubo Verde)
                                 V3: (2, 2, 4) - Canto Frontal-Direito (Cubo Azul)]
                                 V4: (0, 2, 4) - Canto Frontal-Esquerdo (Cubo Azul)
                                 V5: (0, 2, 2) - Canto Frontal-Esquerdo (Cubo Vermelho)
                                 V6: (2, 2, 2) - Canto Interno (Junção dos 3 cubos)]
                                 V7: (2, 3.5, 2) - O "Topo" (Pico central)
                    -->
                    <GeometryModel3D>
                        <GeometryModel3D.Geometry>
                            <MeshGeometry3D 
                                Positions="0,2,0
                                           4,2,0
                                           4,2,2
                                           2,2,4
                                           0,2,4
                                           0,2,2
                                           2,2,2
                                           1.5,3.5,1.5"
                                TriangleIndices="
                                           0 1 6,
                                           0 6 5,
                                           5 6 3,
                                           5 3 4,
                                           0 1 7,
                                           1 2 7,
                                           2 6 7, 
                                           6 3 7,
                                           3 4 7,
                                           4 5 7,
                                           5 0 7
                                           " />
                        </GeometryModel3D.Geometry>
                        <GeometryModel3D.Material>
                            <DiffuseMaterial Brush="Gray"/>
                        </GeometryModel3D.Material>
                        <!-- Adiciona BackMaterial para renderizar as faces internas do telhado -->
                        <GeometryModel3D.BackMaterial>
                            <DiffuseMaterial Brush="Gray"/>
                        </GeometryModel3D.BackMaterial>
                    </GeometryModel3D>

                </Model3DGroup>
            </ModelVisual3D.Content>
        </ModelVisual3D>

    </Viewport3D>

    <!-- 
    3. DEFINIÇÃO DAS ANIMAÇÕES
    Usamos Triggers para iniciar as animações (Storyboard) quando a janela (Window)
    for carregada (FrameworkElement.Loaded).
    -->
    <Window.Triggers>
        <EventTrigger RoutedEvent="FrameworkElement.Loaded">
            <BeginStoryboard>
                <Storyboard>

                    <!-- Questão 3: Câmera girando-->
                    <!-- Gira 180 graus na vertical (de -90 a 90) -->
                    <DoubleAnimation
                        Storyboard.TargetName="CameraRotation"
                        Storyboard.TargetProperty="Angle"
                        From="-90" To="90"
                        Duration="0:0:5"
                        AutoReverse="True"
                        RepeatBehavior="Forever" />

                    <!-- Questão 4: Luz girando -->
                    <!-- Gira 360 graus em 10 segundos, sentido horário. -->
                    <DoubleAnimation
                        Storyboard.TargetName="Light1Rotation"
                        Storyboard.TargetProperty="Angle"
                        From="0" To="360"
                        Duration="0:0:10"
                        RepeatBehavior="Forever" />
                    <!-- Luz 2 -->
                    <!-- Gira 360 graus em 10 segundos, sentido oposto (anti-horário). -->
                    <DoubleAnimation
                        Storyboard.TargetName="Light2Rotation"
                        Storyboard.TargetProperty="Angle"
                        From="0" To="-360"
                        Duration="0:0:10"
                        RepeatBehavior="Forever" />
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </Window.Triggers>
</Window>
